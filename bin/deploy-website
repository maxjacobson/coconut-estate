#!/bin/sh

set -ex

bin/production-build website
bin/ember build --environment=production

bin/scp .docker-cache/target/x86_64-unknown-linux-gnu/release/website \
  www.coconutestate.top:/mnt/website/binary/website-new
bin/scp -r website/dist \
  www.coconutestate.top:/mnt/website/website-new

bin/ssh www.coconutestate.top sudo systemctl stop website.service

bin/ssh www.coconutestate.top mv /mnt/website/binary/website-new /mnt/website/binary/website
bin/ssh www.coconutestate.top rm -rf /mnt/website/website
bin/ssh www.coconutestate.top mv /mnt/website/website-new /mnt/website/website

bin/ssh www.coconutestate.top sudo systemctl restart website.service
