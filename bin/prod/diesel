#!/bin/sh

# this assumes that SSH tunneling is enabled, see bin/prod/start-database-tunnel

set -eu

# TODO: make this work in the docker context or update to require a natively-installed diesel

source ./prod.env
url="postgres://$POSTGRES_USER:$POSTGRES_PASSWORD@localhost:6003/$PG_DATABASE"

docker-compose run \
  -e SSH_AUTH_SOCK \
  --volume "$SSH_AUTH_SOCK:$SSH_AUTH_SOCK" \
  --rm diesel diesel --database-url "$url" "$@"
