#!/bin/sh

set -ex

bin/production-build secrets_keeper
bin/scp .docker-cache/target/x86_64-unknown-linux-gnu/release/secrets_keeper secrets.coconutestate.top:/mnt/secrets-keeper/secrets-keeper-new
bin/ssh secrets.coconutestate.top sudo systemctl stop secrets-keeper.service
bin/ssh secrets.coconutestate.top mv /mnt/secrets-keeper/secrets-keeper /mnt/secrets-keeper/secrets-keeper-old
bin/ssh secrets.coconutestate.top mv /mnt/secrets-keeper/secrets-keeper-new /mnt/secrets-keeper/secrets-keeper
bin/ssh secrets.coconutestate.top sudo systemctl restart secrets-keeper.service
