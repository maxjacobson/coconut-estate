#!/bin/sh

set -ex

bin/production-build api

bin/scp .docker-cache/target/x86_64-unknown-linux-gnu/release/api \
  www.coconutestate.top:/mnt/website/binary/api-new

bin/ssh www.coconutestate.top sudo systemctl stop api.service

bin/ssh www.coconutestate.top mv /mnt/website/binary/api-new /mnt/website/binary/api

bin/ssh www.coconutestate.top sudo systemctl restart api.service
